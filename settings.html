<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ - ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏±‡πâ‡∏á‡∏•‡∏¥‡∏°‡∏¥‡∏ï‡∏´‡∏ß‡∏¢</title>
    <link rel="stylesheet" href="styles.css">
    <script src="config.js"></script>
</head>
<body>
    <!-- Loader -->
    <div class="loader" id="loader">
        <div class="loader-spinner"></div>
    </div>

    <nav class="navbar">
        <div class="nav-brand">üé∞ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏±‡πâ‡∏á‡∏•‡∏¥‡∏°‡∏¥‡∏ï‡∏´‡∏ß‡∏¢</div>
        <button class="menu-toggle" onclick="toggleMobileMenu()">‚ò∞</button>
        <ul class="nav-menu">
            <li><a href="dashboard.html">Dashboard</a></li>
            <li><a href="limit-2digit.html">‡∏•‡∏¥‡∏°‡∏¥‡∏ï 2 ‡∏ï‡∏±‡∏ß</a></li>
            <li><a href="limit-3digit.html">‡∏•‡∏¥‡∏°‡∏¥‡∏ï 3 ‡∏ï‡∏±‡∏ß</a></li>
            <li><a href="settings.html" class="active">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</a></li>
            <li class="hide-desktop"><a href="#" onclick="logoutUser()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a></li>
        </ul>
        <div class="nav-user">
            <span id="currentUser"></span>
            <button class="btn btn-sm btn-danger" onclick="logoutUser()">‡∏≠‡∏≠‡∏Å</button>
        </div>
    </nav>

    <main class="main-content">
        <div class="page-header">
            <h1>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h1>
            <p>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
        </div>

        <!-- Alert Settings -->
        <div class="card">
            <div class="card-header">
                <h3>üîî ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h3>
            </div>
            <div class="card-body">
                <div class="form-row">
                    <div class="form-group">
                        <label>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏∂‡∏á % ‡∏Ç‡∏≠‡∏á‡∏•‡∏¥‡∏°‡∏¥‡∏ï</label>
                        <input type="number" id="alertThreshold" value="80" min="1" max="100">
                    </div>
                    <button class="btn btn-primary" onclick="saveAlertSettings()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                </div>
            </div>
        </div>

        <!-- Default Limits -->
        <div class="card">
            <div class="card-header">
                <h3>üìä ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏•‡∏¥‡∏°‡∏¥‡∏ï</h3>
            </div>
            <div class="card-body">
                <div class="form-group">
                    <label>‡∏•‡∏¥‡∏°‡∏¥‡∏ï‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô 2 ‡∏ï‡∏±‡∏ß (‡∏ö‡∏≤‡∏ó)</label>
                    <input type="number" id="default2DigitLimit" value="5000">
                </div>
                <div class="form-group">
                    <label>‡∏•‡∏¥‡∏°‡∏¥‡∏ï‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô 3 ‡∏ï‡∏±‡∏ß‡πÇ‡∏ï‡πä‡∏î (‡∏ö‡∏≤‡∏ó)</label>
                    <input type="number" id="default3DigitTodeLimit" value="3000">
                </div>
                <div class="form-group">
                    <label>‡∏•‡∏¥‡∏°‡∏¥‡∏ï‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô 3 ‡∏ï‡∏±‡∏ß‡πÄ‡∏ï‡πá‡∏á (‡∏ö‡∏≤‡∏ó)</label>
                    <input type="number" id="default3DigitTengLimit" value="2000">
                </div>
                <button class="btn btn-primary" onclick="saveDefaultLimits()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</button>
            </div>
        </div>

        <!-- Change Password -->
        <div class="card">
            <div class="card-header">
                <h3>üîê ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</h3>
            </div>
            <div class="card-body">
                <div class="form-group">
                    <label>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</label>
                    <input type="password" id="currentPassword" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô">
                </div>
                <div class="form-group">
                    <label>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</label>
                    <input type="password" id="newPassword" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà">
                </div>
                <div class="form-group">
                    <label>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</label>
                    <input type="password" id="confirmPassword" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á">
                </div>
                <button class="btn btn-primary" onclick="changePassword()">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</button>
            </div>
        </div>

        <!-- User Management -->
        <div class="card">
            <div class="card-header">
                <h3>üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h3>
            </div>
            <div class="card-body">
                <div class="form-row">
                    <div class="form-group">
                        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà</label>
                        <input type="text" id="newUsername" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ">
                    </div>
                    <div class="form-group">
                        <label>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                        <input type="password" id="newUserPassword" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
                    </div>
                    <button class="btn btn-success" onclick="addUser()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</button>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</th>
                                <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á</th>
                                <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody id="usersTable">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Data Management -->
        <div class="card">
            <div class="card-header">
                <h3>üíæ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
            </div>
            <div class="card-body">
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="exportAllData()">‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å JSON</button>
                    <input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)">
                    <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ JSON</button>
                </div>
                <div class="btn-group" style="margin-top: 15px;">
                    <button class="btn btn-warning" onclick="clearTodayData()">‡∏•‡πâ‡∏≤‡∏á‡∏¢‡∏≠‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                    <button class="btn btn-danger" onclick="clearAllData()">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                </div>
            </div>
        </div>

        <!-- Database Info -->
        <div class="card">
            <div class="card-header">
                <h3>üóÑÔ∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
            </div>
            <div class="card-body">
                <div id="dbInfo">
                    <p><strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</strong> SQLite (Node.js Server)</p>
                    <p><strong>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö:</strong> ‡πÄ‡∏Å‡πá‡∏ö‡∏ñ‡∏≤‡∏ß‡∏£‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå lottery.db ‡∏ö‡∏ô server</p>
                    <p>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏π‡∏ç‡∏´‡∏≤‡∏¢</p>
                </div>
                <div id="tableStats" style="margin-top: 15px;"></div>
            </div>
        </div>
    </main>

    <script src="db.js"></script>
    <script src="app.js"></script>
    <script>
        checkAuth();
        document.getElementById('currentUser').textContent = getCurrentUser();
        
        async function loadDbStats() {
            try {
                const info = await db.getDbInfo();
                const statsDiv = document.getElementById('tableStats');
                if (statsDiv && info.tables) {
                    let html = '<table class="data-table"><thead><tr><th>‡∏ï‡∏≤‡∏£‡∏≤‡∏á</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th></tr></thead><tbody>';
                    const tableNames = {
                        'users': '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ',
                        'limits_2digit': '‡∏•‡∏¥‡∏°‡∏¥‡∏ï 2 ‡∏ï‡∏±‡∏ß',
                        'limits_3digit_tode': '‡∏•‡∏¥‡∏°‡∏¥‡∏ï 3 ‡∏ï‡∏±‡∏ß‡πÇ‡∏ï‡πä‡∏î',
                        'limits_3digit_teng': '‡∏•‡∏¥‡∏°‡∏¥‡∏ï 3 ‡∏ï‡∏±‡∏ß‡πÄ‡∏ï‡πá‡∏á',
                        'transactions': '‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°'
                    };
                    for (const [table, count] of Object.entries(info.tables)) {
                        html += `<tr><td>${tableNames[table] || table}</td><td>${count}</td></tr>`;
                    }
                    html += '</tbody></table>';
                    statsDiv.innerHTML = html;
                }
            } catch (e) {
                console.error('Error loading db stats:', e);
            }
        }
        
        document.addEventListener('DOMContentLoaded', async function() {
            await loadSettingsPage();
            await loadDbStats();
        });
    </script>
</body>
</html>
